Базовый функционал
Система реализует три основные операции: GET для чтения значения, 
PUT для записи значения и DELETE для удаления ключа. Каждая операция начинается с координатора, который вычисляет три реплики ключа 
с использованием consistent hashing. Координатор присваивает операции уникальный ID и отправляет запрос на все три реплики.

Для GET операции координатор отправляет запросы на три основные реплики и ждет получения ответов от 
количества реплик, равного размеру кворума чтения. Когда кворум собран, координатор выбирает значение с наибольшей временной
 меткой из полученных ответов и возвращает его клиенту.
Для PUT операции координатор вычисляет текущую временную метку на основе системного времени, отправляет запросы на все три 
основные реплики с этой меткой и ожидает ответы. Когда получено количество ответов, равное размеру кворума записи, координатор 
финалит операцию, выбирает значение с наибольшей временной меткой из полученных ответов и возвращает результат клиенту.

Для DELETE операции координатор отправляет запросы на все три реплики с текущей временной меткой. 
Удаление представляется как запись специального значения None с новой временной меткой, что позволяет отличить удаленный ключ от 
никогда не существовавшего ключа.
На уровне реплики каждый узел может получать три типа запросов: запросы от координатора (REPLICA_GET_REQ, REPLICA_PUT_REQ, 
REPLICA_DELETE_REQ) и ответы от других координаторов (REPLICA_GET_RESP, REPLICA_PUT_RESP, REPLICA_DELETE_RESP), а также сообщения о 
исправлении данных (REPLICA_READ_REPAIR).

Когда реплика получает запрос GET, она просто возвращает текущее значение и временную метку из своего локального хранилища. Если ключ не существует, она возвращает None с отрицательной временной меткой.

Когда реплика получает запрос PUT, она применяет Last-Write-Wins логику. Если входящая временная метка равна текущей и оба значения не None, она выбирает значение, которое лексикографически больше. 
Если входящее значение является None (удаление), оно выигрывает только если входящая временная метка больше текущей. Реплика возвращает коордатору текущее значение и метку после применения правила разрешения конфликтов.

Когда реплика получает запрос DELETE, она устанавливает значение в None с новой временной меткой, возвращая координатору то значение, 
которое было до удаления, и его временную метку.

Система использует трехзначную репликацию: каждый ключ автоматически распределяется на ровно три узла в кольце хеширования. 
Репликация вычисляется детерминированно: для каждого ключа вычисляется начальная позиция в кольце, а затем две следующие позиции выбираются последовательно.

Разрешение конфликтов при записи
Система использует Last-Write-Wins. Каждое значение в системе имеет связанную с ним временную метку, которая генерируется на координаторе в момент инициации операции.
Правило разрешения конфликтов применяется по следующей иерархии. Если временные метки различны, выбирается значение с большей временной меткой. Если временные метки одинаковые и оба значения не None (не удаления), 
выбирается значение, которое больше при лексикографическом сравнении строк. Если одно из значений является None, то None никогда не выбирается при равных временных метках, так что неудаленное значение выигрывает.

Это правило применяется в трех местах. Во-первых, на уровне реплики при получении PUT запроса от координатора, который может конфликтовать с уже хранящимся значением. Во-вторых, на уровне координатора при финализации PUT операции, когда координатор получил кворум ответов и выбирает лучшее значение для возврата. В-третьих, при Read Repair, когда координатор после GET обнаруживает, что некоторые реплики содержат устаревшие данные.

Система автоматически синхронизирует отстающие реплики через Read Repair механизм. 
После получения кворума ответов при GET операции координатор определяет лучшее значение с наибольшей временной меткой. 
Затем для каждой реплики в полученном наборе ответов координатор проверяет, отличается ли её значение от лучшего или её временная метка меньше максимальной. 
Если это так, координатор отправляет на эту реплику сообщение Read Repair с актуальным значением и временной меткой. Реплика применяет то же Last-Write-Wins.